# 美容室顧客データリピート分析システム

美容室の顧客データを用いて、新規顧客のリピート状況を多角的に分析し、インタラクティブなダッシュボード形式で可視化するFlask Webアプリケーションです。

## 機能概要

### 主要機能
- **CSVファイルアップロード**: 複数ファイルの同時アップロード対応
- **データクレンジング**: 顧客同定・統合処理
- **リピート分析**: 多角的な分析（ファネル、スタイリスト別、クーポン別、目標比較など）
- **インタラクティブダッシュボード**: Chart.jsによる可視化
- **レポート出力**: テキストレポートの生成・ダウンロード

### 分析項目
1. **顧客リピート状況概要**
   - 新規顧客総数
   - X回以上リピーター数・率
   - 初回リピート率

2. **リピートファネル分析**
   - ステージ別顧客数と継続率
   - リピート回数分布と累積割合

3. **スタイリスト別分析**
   - スタイリスト別リピート率
   - トップスタイリスト特定

4. **クーポン別分析**
   - クーポン別効果測定
   - 最も効果的なクーポンの特定

5. **目標値比較分析**
   - 目標と実績の比較
   - 目標達成に必要な追加顧客数

6. **期間分析**
   - 初回リピートまでの期間分布
   - 月別トレンド分析

## 技術スタック

- **Backend**: Python 3.12, Flask 3.0
- **Data Processing**: Pandas, NumPy
- **Visualization**: Chart.js, Plotly
- **Frontend**: Bootstrap 5, HTML5, JavaScript ES6
- **File Handling**: chardet (エンコーディング自動判定)

## セットアップ

### 前提条件
- Python 3.12以上
- pip (パッケージ管理)

### インストール手順

1. **リポジトリのクローン**
```bash
git clone <repository-url>
cd hpb-repeat-analyzer
```

2. **仮想環境の作成・有効化**
```bash
python -m venv .venv
# Windows
.venv\Scripts\activate
# macOS/Linux
source .venv/bin/activate
```

3. **依存関係のインストール**
```bash
pip install -r requirements.txt
```

4. **アプリケーションの起動**
```bash
python app.py
```

5. **ブラウザでアクセス**
```
http://localhost:5000
```

## 使用方法

### 1. CSVファイルのアップロード
- 美容室の来店履歴データ（CSV形式）を選択
- 複数ファイルの同時アップロード可能
- エンコーディング自動判定（UTF-8, Shift-JIS対応）

### 2. 分析設定
- **新規顧客抽出期間**: 新規顧客を特定する期間
- **リピート集計終了日**: リピート状況を集計する終了日
- **目標値設定**: 各リピート段階の目標値
- **分析パラメータ**: 最低顧客数などの閾値設定

### 3. 結果の確認
- ダッシュボードで多角的な分析結果を確認
- レポート出力（テキスト形式）でデータ保存
- 印刷機能で物理レポート作成

## データ形式

### 必要なCSVカラム
- `ステータス`: 予約状態（"済み"が対象）
- `来店日`: YYYYMMDD形式
- `このサロンに行くのは初めてですか？`: 新規顧客判定
- `スタイリスト名`: 担当スタイリスト
- `予約時HotPepperBeautyクーポン`: 利用クーポン
- `電話番号`, `氏名`, `お客様番号`: 顧客同定用

### データクレンジング機能
- 電話番号の正規化
- 氏名の統一処理
- 顧客IDの自動生成
- データ整合性チェック

## プロジェクト構造

```
hpb-repeat-analyzer/
├── app.py                 # メインアプリケーション
├── requirements.txt       # 依存関係
├── README.md             # プロジェクト説明
├── modules/              # 分析モジュール
│   ├── __init__.py
│   ├── data_processor.py    # データ処理
│   ├── repeat_analyzer.py   # リピート分析
│   ├── visualization.py     # 可視化
│   └── report_generator.py  # レポート生成
├── templates/            # HTMLテンプレート
│   ├── base.html
│   ├── index.html
│   ├── dashboard.html
│   └── error.html
├── static/               # 静的ファイル
│   ├── css/
│   │   └── style.css
│   └── js/
│       └── app.js
├── uploads/              # アップロードファイル
├── reports/              # 生成レポート
└── docs/                 # ドキュメント
    └── requirements.md   # 要件定義書
```

## 設定

### アプリケーション設定
- `SECRET_KEY`: セキュリティキー
- `UPLOAD_FOLDER`: アップロードディレクトリ
- `MAX_CONTENT_LENGTH`: 最大ファイルサイズ（100MB）

### 分析パラメータ
- `min_repeat_count`: X回以上リピートの基準（デフォルト: 3回）
- `min_stylist_customers`: スタイリスト分析の最低顧客数（デフォルト: 10人）
- `min_coupon_customers`: クーポン分析の最低顧客数（デフォルト: 5人）

## トラブルシューティング

### よくある問題

1. **CSVファイルが読み込めない**
   - エンコーディングの確認（UTF-8, Shift-JIS推奨）
   - ファイルサイズの確認（100MB以下）
   - 必須カラムの存在確認

2. **新規顧客が見つからない**
   - 指定期間の確認
   - 「このサロンに行くのは初めてですか？」カラムの値確認
   - ステータス「済み」のデータ存在確認

3. **分析結果が表示されない**
   - データ品質の確認
   - 最低顧客数設定の調整
   - ログファイルの確認

### ログ出力
アプリケーションは詳細なログを出力します。問題発生時はコンソール出力を確認してください。

## ライセンス

このプロジェクトは社内利用を想定しており、著作権は開発者に帰属します。

## サポート

技術的な問題や機能追加のご要望については、開発チームまでお問い合わせください。

## 更新履歴

- **v1.0.0** (2024-01-15): 初期リリース
  - 基本的なリピート分析機能
  - ダッシュボード表示
  - レポート出力機能

---

**開発者**: HPB Repeat Analyzer Team  
**最終更新**: 2024年1月15日 